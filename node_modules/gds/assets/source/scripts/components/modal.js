function ModalManager() {
  $(document).on('click', '[gds\\:modal\\:toggle]', function (e) {
    e.preventDefault();

    var $that = $(this);
    if (target = $that.attr('gds:modal:target')) {
      var options = {
        url: $that.attr('gds:modal:href'),
        query: $that.attr('gds:modal:query'),
        confirm: $that.attr('gds:modal:confirm-callback'),
        beforeOpen: $that.attr('gds:modal:before-open-callback'),
        $caller: $that
      }

      GDS.modal.open(target, options);
    }
  });

  $(document).on('click', '[gds\\:modal\\:dismiss]', function (e) {
    e.preventDefault();

    var $that = $(this);
    if (modal = $that.parents('.gds-modal.open')) {
      GDS.modal.dismiss(modal);
    }
  });

  $(document).on('click', '[gds\\:modal\\:confirm]', function (e) {
    e.preventDefault();

    var $that = $(this);
    if (modal = $that.parents('.gds-modal.open')) {
      GDS.modal.confirm();
      GDS.modal.dismiss();
    }
  });

  $(document).on('keyup', function (e) {
    if (e.keyCode == 27 && $('.gds-modal.open').length > 0) {
      GDS.modal.dismiss();
    }
  });
}

ModalManager.prototype.open = function (target, options) {
  var that = this;
  this.$modal = $(target);

  if (!options) {
    options = {};
  }

  this.query = options.query;
  this.$caller = options.$caller;

  this.beforeOpen = function() {
    eval(options.beforeOpen);
  }

  this.confirm = function () {
    eval(options.confirm);
  }

  if (this.url = options.url) {
    $.ajax({
      url: options.url,
      data: this.query,
      method: 'GET',
      cache: false,
      beforeSend: function (e) {
        GDS.loading.open();
      },
      complete: function (data) {
        that.$modal.html($(data.responseText));
        that.beforeOpen();
        GDS.loading.close();
        that.$modal.addClass('open');
      }
    });
  } else {
    that.beforeOpen();
    this.$modal.addClass('open');
  }
}

ModalManager.prototype.dismiss = function (target) {
  if (target) {
    var $target = $(target);
    $target.removeClass('open');
  } else {
    this.$modal.removeClass('open');
  }
}