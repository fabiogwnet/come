$(document).ready(function(){
  $('body').on('click', function (e) {
    if (!$(e.target).is('[data-toggle="dropdown-fixed"]') && $(e.target).closest('.dropdown-menu').length == 0 && !$(e.target).parent().is('[data-toggle="dropdown-fixed"]') ) {
      $('[data-toggle="dropdown-fixed"]').parent().removeClass('show');
      $('[data-toggle="dropdown-fixed"]').siblings('.dropdown-menu').removeClass('show');
    }
  });

  $('body').on('click', '[data-toggle="dropdown-fixed"]', function () {
      $(this).parent().toggleClass('show');
      $(this).siblings('.dropdown-menu').toggleClass('show');
  });

  $('[data-required-relative]').each(function(){
    var $element = $(this);
    var $target = $($(this).data('required-relative'));
    if( typeof $(this).data('required-value') !== 'undefined' ) {
      if( $(this).data('required-value').toString().indexOf(',') > -1 ) {
        var values = $(this).data('required-value').split(',');
      } else {
        var values = [$(this).data('required-value').toString()];
      }
    }

    if( $target.is('select')) {
      $target.on('change', function(){
        if( values ) {
          if( values.indexOf($(this).val()) > -1 ) {
            $element.removeClass('ignore');
          } else {
            $element.addClass('ignore');
          }
        } else {
          if( $(this).val() != '' ) {
            $element.removeClass('ignore');
          } else {
            $element.addClass('ignore');
          }
        }
      }).trigger('change');
    }

    if( $target.is('[type="radio"]')) {
      $target.on('change', function(){
        if( values ) {
          if( values.indexOf( $target.filter(':checked').val() ) > -1 ) {
            $element.removeClass('ignore');
          } else {
            $element.addClass('ignore');
          }
        } else {
          if( $target.filter(':checked').val() != '' ) {
            $element.removeClass('ignore');
          } else {
            $element.addClass('ignore');
          }
        }
      });

      $target.filter(':checked').trigger('change');
    }

    if( $target.is('[type="checkbox"]')) {
      $target.on('change', function(){
        if( $target.is(':checked') ) {
          $element.removeClass('ignore');
        } else {
          $element.addClass('ignore');
        }
      });

      $target.trigger('change');
    }
  });

  $('[data-toggle-relative]').each(function(){
    var $element = $(this);
    var $target = $($(this).data('toggle-relative'));
    var inverse = $(this).data('toggle-inverse');

    if( typeof $(this).data('toggle-value') !== 'undefined' ) {
      if( $(this).data('toggle-value').toString().indexOf(',') > -1 ) {
        var values = $(this).data('toggle-value').split(',');
      } else {
        var values = [$(this).data('toggle-value').toString()];
      }
    }

    if( $target.is('select')) {
      $target.on('change', function(){
        if( values ) {
          var selected = !inverse ? values.indexOf($(this).val()) > -1 : values.indexOf($(this).val()) == -1;

          if( selected ) {
            $element.removeClass('d-none');
          } else {
            $element.addClass('d-none');
          }
        } else {
          if( $(this).val() != '' ) {
            $element.removeClass('d-none');
          } else {
            $element.addClass('d-none');
          }
        }
      }).trigger('change');
    }

    if( $target.is('[type="radio"]')) {
      $target.on('change', function(){
        if( values ) {
          if( values.indexOf( $target.filter(':checked').val() ) > -1 ) {
            $element.removeClass('d-none');
          } else {
            $element.addClass('d-none');
          }
        } else {
          if( $target.filter(':checked').val() != '' ) {
            $element.removeClass('d-none');
          } else {
            $element.addClass('d-none');
          }
        }
      });

      $target.filter(':checked').trigger('change');
    }

    if( $target.is('[type="checkbox"]')) {
      $target.on('change', function(){
        var checked = !inverse ? $target.is(':checked') : !$target.is(':checked');

        if( checked ) {
          $element.removeClass('d-none');
        } else {
          $element.addClass('d-none');
        }
      });

      $target.trigger('change');
    }
  });
});
